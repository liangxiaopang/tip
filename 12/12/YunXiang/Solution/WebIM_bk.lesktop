{"Data":{"Forms":[{"Constructor":"CustomControlDesignPH","Config":{"Controls":[{"Constructor":"SimpleTabControlPH","Config":{"_Css":"simple_tab","_BorderWidth":1,"OnSelectedTabCode":"","InitCode":"","Tabs":[{"Text":"聊天","Width":80,"ID":"ID000020","IsSelected":true}],"DesignPHBs":[{"Constructor":"SimplePlaceHolder","Config":{"Controls":[{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"","InitCode":"","ClassName":"MsgPanel","Count":0,"Left":5,"Top":5,"Width":472,"Height":231,"Name":"m_MsgPanel","Text":"","AnchorStyle":15}},{"Constructor":"ButtonPH","Config":{"_Css":"button_default","OnClickCode":"var data = {\u000d\u000a    Sender: User\u002c\u000d\u000a    Receiver: Peer\u002c\u000d\u000a    Content: m_MsgEditor.GetValue()\u000d\u000a};\u000d\u000a\u000d\u000am_MsgPanel.AddMessage(data);\u000d\u000am_MsgEditor.SetValue(\u0022\u0022);\u000d\u000a\u000d\u000afunction Send_Error(ex)\u000d\u000a{\u000d\u000a    alert(ex);\u000d\u000a}\u000d\u000a\u000d\u000afunction Send_Callback(xml\u002c text)\u000d\u000a{\u000d\u000a    var message = System.ParseJson(text);\u000d\u000a}\u000d\u000a\u000d\u000aSystem.Post(Send_Callback\u002c Send_Error\u002c \u0022send.aspx\u0022\u002c System.RenderJson(data));","InitCode":"","Count":0,"Left":410,"Top":415,"Width":67,"Height":26,"Name":"m_BtnOK","Text":"发送","AnchorStyle":12}},{"Constructor":"CustomControlObjectPH","Config":{"_Css":"control","ConfigCode":"m_MsgEditor_Config.BorderWidth = 1;\u000d\u000am_MsgEditor_Config.Css = \u0022richEditor\u0022;","InitCode":"","ClassName":"MsgEditor","Count":0,"Left":5,"Top":243,"Width":472,"Height":166,"Name":"m_MsgEditor","Text":"","AnchorStyle":13}}],"Count":0,"Left":0,"Top":0,"Width":482,"Height":449,"Name":"tab1.GetPanel(0)","Text":"","AnchorStyle":15}}],"Count":0,"Left":0,"Top":0,"Width":484,"Height":476,"Name":"tab1","Text":"","AnchorStyle":15}}],"MemberCode":"Controls.CreateHorizSplit(m_MsgPanel\u002c m_MsgEditor\u002c false);\u000d\u000a\u000d\u000avar m_From = new Date(0);\u000d\u000avar m_ErrorCount = 0;\u000d\u000a\u000d\u000afunction Receive()\u000d\u000a{\u000d\u000a    var data = {\u000d\u000a        Receiver: User\u002c\u000d\u000a        Sender: Peer\u002c\u000d\u000a        From: m_From\u000d\u000a    };\u000d\u000a\u000d\u000a    function Receive_Error(ex)\u000d\u000a    {\u000d\u000a        alert(ex);\u000d\u000a        m_ErrorCount++;\u000d\u000a        if (m_ErrorCount \u003c 5)\u000d\u000a        {\u000d\u000a            setTimeout(Receive\u002c 1000);\u000d\u000a        }\u000d\u000a    }\u000d\u000a\u000d\u000a    function Receive_Callback(xml\u002c text)\u000d\u000a    {\u000d\u000a        m_ErrorCount = 0;\u000d\u000a        var ret = System.ParseJson(text);\u000d\u000a        for (var i in ret.Messages)\u000d\u000a        {\u000d\u000a            m_MsgPanel.AddMessage(ret.Messages[i]);\u000d\u000a        }\u000d\u000a        if (ret.Messages.length \u003e 0)\u000d\u000a        {\u000d\u000a            m_From = ret.Messages[ret.Messages.length - 1].CreatedTime;\u000d\u000a        }\u000d\u000a        setTimeout(Receive\u002c 50);\u000d\u000a    }\u000d\u000a\u000d\u000a    System.Post(Receive_Callback\u002c Receive_Error\u002c \u0022recevie.aspx\u0022\u002c System.RenderJson(data));\u000d\u000a}\u000d\u000a\u000d\u000aReceive();","CustomConfig":"config.Css = \u0022MainWnd\u0022;","BaseName":"Control","GlobalCode":"","Count":5,"Left":11,"Top":13,"Width":484,"Height":476,"Name":"MainWnd","Text":"","AnchorStyle":0}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[],"MemberCode":"This.AddMessage = function(msg)\u000d\u000a{\u000d\u000a    var msgDiv = This.GetDocument().createElement(\u0022DIV\u0022);\u000d\u000a    msgDiv.className = \u0022message\u0022;\u000d\u000a    msgDiv.innerHTML = String.format(MessageFormat\u002c msg.Sender\u002c DateToString(msg.CreatedTime == undefined ? new Date() : msg.CreatedTime)\u002c msg.Content);\u000d\u000a    This.GetDocument().body.appendChild(msgDiv);\u000d\u000a    msgDiv.scrollIntoView();\u000d\u000a    msgDiv = null;\u000d\u000a}\u000d\u000a\u000d\u000aThis.Link(\u0022StyleSheet\u0022\u002c \u0022Themes/Default/EditorCss.css\u0022\u002c \u0022text/css\u0022);","CustomConfig":"config.BorderWidth = 1;\u000d\u000aconfig.Css = \u0022MsgPanel\u0022;","BaseName":"Controls.Frame","GlobalCode":"","Count":0,"Left":108,"Top":51,"Width":200,"Height":200,"Name":"MsgPanel","Text":"CustomControl1","AnchorStyle":3}},{"Constructor":"FormPH","Config":{"_Css":"window","HasMinButton":false,"HasMaxButton":false,"Resizable":false,"MemberCode":"var m_Result = false;\u000d\u000a\u000d\u000aThis.GetResult = function()\u000d\u000a{\u000d\u000a    return m_Result;\u000d\u000a}\u000d\u000a\u000d\u000aThis.GetUser = function()\u000d\u000a{\u000d\u000a    return m_User.GetText();\u000d\u000a}\u000d\u000a\u000d\u000aThis.GetPeer = function()\u000d\u000a{\u000d\u000a    return m_Peer.GetText();\u000d\u000a}","CustomConfigCode":"","Controls":[{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":9,"Top":19,"Width":78,"Height":14,"Name":"label1","Text":"你的用户名：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":96,"Top":14,"Width":216,"Height":22,"Name":"m_User","Text":"","AnchorStyle":3}},{"Constructor":"LabelPH","Config":{"_Css":"label","InitCode":"","Count":0,"Left":10,"Top":52,"Width":82,"Height":14,"Name":"label3","Text":"对方用户名：","AnchorStyle":3}},{"Constructor":"TextBoxPH","Config":{"_Css":"textbox","InitCode":"","BorderWidth":1,"Count":0,"Left":96,"Top":47,"Width":215,"Height":22,"Name":"m_Peer","Text":"","AnchorStyle":3}},{"Constructor":"ButtonPH","Config":{"_Css":"button_default","OnClickCode":"if (m_User.GetText() == \u0022\u0022)\u000d\u000a{\u000d\u000a    alert(\u0022请输入您的用户名！\u0022);\u000d\u000a    return;\u000d\u000a}\u000d\u000aif (m_Peer.GetText() == \u0022\u0022)\u000d\u000a{\u000d\u000a    alert(\u0022请输入对方用户名！\u0022);\u000d\u000a    return;\u000d\u000a}\u000d\u000am_Result = true;\u000d\u000aThis.Close();","InitCode":"","Count":0,"Left":214,"Top":79,"Width":96,"Height":26,"Name":"button5","Text":"开始会话","AnchorStyle":3}}],"Count":5,"Left":17,"Top":34,"Width":332,"Height":144,"Name":"GetUserForm","Text":"用户名","AnchorStyle":3}},{"Constructor":"CustomControlDesignPH","Config":{"Controls":[],"MemberCode":"","CustomConfig":"","BaseName":"RichEditor","GlobalCode":"","Count":0,"Left":0,"Top":0,"Width":200,"Height":200,"Name":"MsgEditor","Text":"CustomControl1","AnchorStyle":3}}],"InitCode":"completeCallback();","DisposeCode":"completeCallback();","ModuleGlobalCode":"var User\u002c Peer;\u000d\u000a\u000d\u000avar MessageFormat=\u000d\u000a\u0022\u003cdiv class=\u0027message\u0027\u003e\u0022 + \u000d\u000a    \u0022\u003cdiv class=\u0027messageTitle\u0027\u003e\u0022 + \u000d\u000a        \u0022\u003cspan class=\u0027sender\u0027\u003e{0}\u003c/span\u003e\u0022 + \u000d\u000a        \u0022\u003cspan class=\u0027time\u0027\u003e{1}\u003c/span\u003e\u0022 + \u000d\u000a    \u0022\u003c/div\u003e\u0022 + \u000d\u000a    \u0022\u003cdiv class=\u0027messageContent\u0027\u003e{2}\u003c/div\u003e\u0022 + \u000d\u000a\u0022\u003c/div\u003e\u003cbr/\u003e\u0022;\u000d\u000a\u000d\u000a//格式化数字\u000d\u000afunction FormatNumber(num\u002c length)\u000d\u000a{\u000d\u000a    var s = num.toString();\u000d\u000a    var zero = \u0022\u0022;\u000d\u000a    for (var i = 0; i \u003c length - s.length; i++) zero += \u00220\u0022;\u000d\u000a    return zero + s;\u000d\u000a}\u000d\u000a\u000d\u000a//时间转字符串\u000d\u000afunction DateToString(date)\u000d\u000a{\u000d\u000a    return String.format(\u0022{0}-{1}-{2} {3}:{4}:{5}\u0022\u002c FormatNumber(date.getFullYear()\u002c 4)\u002c FormatNumber(date.getMonth() + 1\u002c 2)\u002c FormatNumber(date.getDate()\u002c 2)\u002c FormatNumber(date.getHours()\u002c 2)\u002c FormatNumber(date.getMinutes()\u002c 2)\u002c FormatNumber(date.getSeconds()\u002c 2));\u000d\u000a}","AppStartCode":"var guform = new GetUserForm();\u000d\u000a\u000d\u000afunction GetUser_OnClose()\u000d\u000a{\u000d\u000a    if (guform.GetResult() == false) return;\u000d\u000a\u000d\u000a    User = guform.GetUser();\u000d\u000a    Peer = guform.GetPeer();\u000d\u000a\u000d\u000a    var form = new Window({\u000d\u000a        Left: 0\u002c\u000d\u000a        Top: 0\u002c\u000d\u000a        Width: 800\u002c\u000d\u000a        Height: 600\u002c\u000d\u000a        Parent: null\u002c\u000d\u000a        Css: \u0022window\u0022\u002c\u000d\u000a        BorderWidth: 6\u002c\u000d\u000a        HasMinButton: true\u002c\u000d\u000a        HasMaxButton: true\u002c\u000d\u000a        Title: {\u000d\u000a            InnerHTML: \u0022调试\u0022\u000d\u000a        }\u000d\u000a    });\u000d\u000a\u000d\u000a    m_MainForm = new MainWnd({\u000d\u000a        Left: 0\u002c\u000d\u000a        Top: 0\u002c\u000d\u000a        Width: form.GetClientWidth()\u002c\u000d\u000a        Height: form.GetClientHeight()\u002c\u000d\u000a        Parent: form\u002c\u000d\u000a        AnchorStyle: Controls.AnchorStyle.All\u002c\u000d\u000a        Css: \u0022mainwnd\u0022\u000d\u000a    });\u000d\u000a\u000d\u000a    form.OnClosed.Attach(\u000d\u000a    function()\u000d\u000a    {\u000d\u000a        CurrentApplication.Dispose();\u000d\u000a    });\u000d\u000a\u000d\u000a    form.MoveEx(\u0022center\u0022\u002c 0\u002c 0);\u000d\u000a    form.Show();\u000d\u000a}\u000d\u000a\u000d\u000aguform.OnClosed.Attach(GetUser_OnClose);\u000d\u000aguform.MoveEx(\u0022center\u0022\u002c 0\u002c -100);\u000d\u000aguform.Show();","AppGlobal":"","AppTerminateCode":"completeCallback();"},"Css":{"CssCode":".MsgPanel\u000d\u000a{\u000d\u000a    border: solid 1px #D0D0D0;\u000d\u000a}\u000d\u000a\u000d\u000a.MainWnd\u000d\u000a{\u000d\u000a    background-color:#EFF0F2;\u000d\u000a}"},"Version":"1.0"}